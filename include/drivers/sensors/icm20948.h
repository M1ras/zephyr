/*
 * Copyright (c) 2018 Miras Absar
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef ICM20948_H
#define ICM20948_H

/*
 * USER BANK 0 REGISTER MAP
 * See ICM-20948 Datasheet, Section 7.1
 */
#define ICM20948_REG_WHO_AM_I			0x00
#define ICM20948_REG_USER_CTRL			0x03
#define ICM20948_REG_LP_CONFIG			0x05
#define ICM20948_REG_PWR_MGMT_1			0x06
#define ICM20948_REG_PWR_MGMT_2			0x07
#define ICM20948_REG_INT_PIN_CFG		0x0F
#define ICM20948_REG_INT_ENABLE			0x10
#define ICM20948_REG_INT_ENABLE_1		0x11
#define ICM20948_REG_INT_ENABLE_2		0x12
#define ICM20948_REG_INT_ENABLE_3		0x13
#define ICM20948_REG_I2C_MST_STATUS		0x17
#define ICM20948_REG_INT_STATUS			0x19
#define ICM20948_REG_INT_STATUS_1		0x1A
#define ICM20948_REG_INT_STATUS_2		0x1B
#define ICM20948_REG_INT_STATUS_3		0x1C
#define ICM20948_REG_DELAY_TIMEH		0x28
#define ICM20948_REG_DELAY_TIMEL		0x29
#define ICM20948_REG_ACCEL_XOUT_H		0x2D
#define ICM20948_REG_ACCEL_XOUT_L		0x2E
#define ICM20948_REG_ACCEL_YOUT_H		0x2F
#define ICM20948_REG_ACCEL_YOUT_L		0x30
#define ICM20948_REG_ACCEL_ZOUT_H		0x31
#define ICM20948_REG_ACCEL_ZOUT_L		0x32
#define ICM20948_REG_GYRO_XOUT_H		0x33
#define ICM20948_REG_GYRO_XOUT_L		0x34
#define ICM20948_REG_GYRO_YOUT_H		0x35
#define ICM20948_REG_GYRO_YOUT_L		0x36
#define ICM20948_REG_GYRO_ZOUT_H		0x37
#define ICM20948_REG_GYRO_ZOUT_L		0x38
#define ICM20948_REG_TEMP_OUT_H			0x39
#define ICM20948_REG_TEMP_OUT_L			0x3A
#define ICM20948_REG_EXT_SLV_SENS_DATA_00	0x3B
#define ICM20948_REG_EXT_SLV_SENS_DATA_01	0x3C
#define ICM20948_REG_EXT_SLV_SENS_DATA_02	0x3D
#define ICM20948_REG_EXT_SLV_SENS_DATA_03	0x3E
#define ICM20948_REG_EXT_SLV_SENS_DATA_04	0x3F
#define ICM20948_REG_EXT_SLV_SENS_DATA_05	0x40
#define ICM20948_REG_EXT_SLV_SENS_DATA_06	0x41
#define ICM20948_REG_EXT_SLV_SENS_DATA_07	0x42
#define ICM20948_REG_EXT_SLV_SENS_DATA_08	0x43
#define ICM20948_REG_EXT_SLV_SENS_DATA_09	0x44
#define ICM20948_REG_EXT_SLV_SENS_DATA_10	0x45
#define ICM20948_REG_EXT_SLV_SENS_DATA_11	0x46
#define ICM20948_REG_EXT_SLV_SENS_DATA_12	0x47
#define ICM20948_REG_EXT_SLV_SENS_DATA_13	0x48
#define ICM20948_REG_EXT_SLV_SENS_DATA_14	0x49
#define ICM20948_REG_EXT_SLV_SENS_DATA_15	0x4A
#define ICM20948_REG_EXT_SLV_SENS_DATA_16	0x4B
#define ICM20948_REG_EXT_SLV_SENS_DATA_17	0x4C
#define ICM20948_REG_EXT_SLV_SENS_DATA_18	0x4D
#define ICM20948_REG_EXT_SLV_SENS_DATA_19	0x4E
#define ICM20948_REG_EXT_SLV_SENS_DATA_20	0x4F
#define ICM20948_REG_EXT_SLV_SENS_DATA_21	0x50
#define ICM20948_REG_EXT_SLV_SENS_DATA_22	0x51
#define ICM20948_REG_EXT_SLV_SENS_DATA_23	0x52
#define ICM20948_REG_FIFO_EN_1			0x66
#define ICM20948_REG_FIFO_EN_2			0x67
#define ICM20948_REG_FIFO_RST			0x68
#define ICM20948_REG_FIFO_MODE			0x69
#define ICM20948_REG_FIFO_COUNTH		0x70
#define ICM20948_REG_FIFO_COUNTL		0x71
#define ICM20948_REG_FIFO_R_W			0x72
#define ICM20948_REG_DATA_RDY_STATUS		0x74
#define ICM20948_REG_FIFO_CFG			0x76
#define ICM20948_REG_REG_BANK_SEL		0x7F

/*
 * USER BANK 1 REGISTER MAP
 * See ICM-20948 Datasheet, Section 7.2
 */
#define ICM20948_REG_SELF_TEST_X_GYRO		0x02
#define ICM20948_REG_SELF_TEST_Y_GYRO		0x03
#define ICM20948_REG_SELF_TEST_Z_GYRO		0x04
#define ICM20948_REG_SELF_TEST_X_ACCEL		0x0E
#define ICM20948_REG_SELF_TEST_Y_ACCEL		0x0F
#define ICM20948_REG_SELF_TEST_Z_ACCEL		0x10
#define ICM20948_REG_XA_OFFS_H			0x14
#define ICM20948_REG_XA_OFFS_L			0x15
#define ICM20948_REG_YA_OFFS_H			0x17
#define ICM20948_REG_YA_OFFS_L			0x18
#define ICM20948_REG_ZA_OFFS_H			0x1A
#define ICM20948_REG_ZA_OFFS_L			0x1B
#define ICM20948_REG_TIMEBASE_CORRECTION_PLL	0x28

/*
 * USER BANK 2 REGISTER MAP
 * See ICM-20948 Datasheet, Section 7.3
 */
#define ICM20948_REG_GYRO_SMPLRT_DIV		0x00
#define ICM20948_REG_GYRO_CONFIG_1		0x01
#define ICM20948_REG_GYRO_CONFIG_2		0x02
#define ICM20948_REG_XG_OFFS_USRH		0x03
#define ICM20948_REG_XG_OFFS_USRL		0x04
#define ICM20948_REG_YG_OFFS_USRH		0x05
#define ICM20948_REG_YG_OFFS_USRL		0x06
#define ICM20948_REG_ZG_OFFS_USRH		0x07
#define ICM20948_REG_ZG_OFFS_USRL		0x08
#define ICM20948_REG_ODR_ALIGN_EN		0x09
#define ICM20948_REG_ACCEL_SMPLRT_DIV_1		0x10
#define ICM20948_REG_ACCEL_SMPLRT_DIV_2		0x11
#define ICM20948_REG_ACCEL_INTEL_CTRL		0x12
#define ICM20948_REG_ACCEL_WOM_THR		0x13
#define ICM20948_REG_ACCEL_CONFIG		0x14
#define ICM20948_REG_ACCEL_CONFIG_2		0x15
#define ICM20948_REG_FSYNC_CONFIG		0x52
#define ICM20948_REG_TEMP_CONFIG		0x53
#define ICM20948_REG_MOD_CTRL_USR		0x54

/*
 * USER BANK 3 REGISTER MAP
 * See ICM-20948 Datasheet, Section 7.4
 */
#define ICM20948_REG_I2C_MST_ODR_CONFIG		0x00
#define ICM20948_REG_I2C_MST_CTRL		0x01
#define ICM20948_REG_I2C_MST_DELAY_CTRL		0x02
#define ICM20948_REG_I2C_SLV0_ADDR		0x03
#define ICM20948_REG_I2C_SLV0_REG		0x04
#define ICM20948_REG_I2C_SLV0_CTRL		0x05
#define ICM20948_REG_I2C_SLV0_DO		0x06
#define ICM20948_REG_I2C_SLV1_ADDR		0x07
#define ICM20948_REG_I2C_SLV1_REG		0x08
#define ICM20948_REG_I2C_SLV1_CTRL		0x09
#define ICM20948_REG_I2C_SLV1_DO		0x0A
#define ICM20948_REG_I2C_SLV2_ADDR		0x0B
#define ICM20948_REG_I2C_SLV2_REG		0x0C
#define ICM20948_REG_I2C_SLV2_CTRL		0x0D
#define ICM20948_REG_I2C_SLV2_DO		0x0E
#define ICM20948_REG_I2C_SLV3_ADDR		0x0F
#define ICM20948_REG_I2C_SLV3_REG		0x10
#define ICM20948_REG_I2C_SLV3_CTRL		0x11
#define ICM20948_REG_I2C_SLV3_DO		0x12
#define ICM20948_REG_I2C_SLV4_ADDR		0x13
#define ICM20948_REG_I2C_SLV4_REG		0x14
#define ICM20948_REG_I2C_SLV4_CTRL		0x15
#define ICM20948_REG_I2C_SLV4_DO		0x16
#define ICM20948_REG_I2C_SLV4_DI		0x17

#define ICM20948_VAL_WHO_AM_I			0xEA
#define ICM20648_VAL_WHO_AM_I			0xE0

/*
 * USER_CTRL Bit Masks
 * See ICM-20948 Datasheet, Section 8.2
 */
#define ICM20948_MASK_DMP_EN			BIT(7)
#define ICM20948_MASK_FIFO_EN			BIT(6)
#define ICM20948_MASK_I2C_MST_EN		BIT(5)
#define ICM20948_MASK_I2C_IF_DIS		BIT(4)
#define ICM20948_MASK_DMP_RST			BIT(3)
#define ICM20948_MASK_SRAM_RST			BIT(2)
#define ICM20948_MASK_I2C_MST_RST		BIT(1)

/*
 * LP_CONFIG Bit Masks
 * See ICM-20948 Datasheet, Section 8.3
 */
#define ICM20948_MASK_I2C_MST_CYCLE		BIT(6)
#define ICM20948_MASK_ACCEL_CYCLE		BIT(5)
#define ICM20948_MASK_GYRO_CYCLE		BIT(4)

/*
 * PWR_MGMT_1 Bit Masks
 * See ICM-20948 Datasheet, Section 8.4
 */
#define ICM20948_MASK_DEVICE_RESET		BIT(7)
#define ICM20948_MASK_SLEEP			BIT(6)
#define ICM20948_MASK_LP_EN			BIT(5)
#define ICM20948_MASK_TEMP_DIS			BIT(3)
#define ICM20948_MASK_CLKSEL			0b00000111

/*
 * PWR_MGMT_2 Bit Masks
 * See ICM-20948 Datasheet, Section 8.5
 */
#define ICM20948_MASK_DISABLE_ACCEL		0b00111000
#define ICM20948_MASK_DISABLE_GYRO		0b00000111

/*
 * INT_PIN_CFG Bit Masks
 * See ICM-20948 Datasheet, Section 8.6
 */
#define ICM20948_MASK_INT1_ACTL			BIT(7)
#define ICM20948_MASK_INT1_OPEN			BIT(6)
#define ICM20948_MASK_INT1_LATCH__EN		BIT(5)
#define ICM20948_MASK_INT_ANYRD_2CLEAR		BIT(4)
#define ICM20948_MASK_ACTL_FSYNC		BIT(3)
#define ICM20948_MASK_FSYNC_INT_MODE_EN		BIT(2)
#define ICM20948_MASK_BYPASS_EN			BIT(1)

/*
 * INT_ENABLE Bit Masks
 * See ICM-20948 Datasheet, Section 8.7
 */
#define ICM20948_MASK_REG_WOF_EN		BIT(7)
#define ICM20948_MASK_WOM_INT_EN		BIT(3)
#define ICM20948_MASK_PLL_RDY_EN		BIT(2)
#define ICM20948_MASK_DMP_INT1_EN		BIT(1)
#define ICM20948_MASK_I2C_MST_INT_EN		BIT(0)

/*
 * INT_ENABLE_1 Bit Masks
 * See ICM-20948 Datasheet, Section 8.8
 */
#define ICM20948_MASK_RAW_DATA_0_RDY_EN		BIT(0)

/*
 * INT_ENABLE_2 Bit Masks
 * See ICM-20948 Datasheet, Section 8.9
 */
#define ICM20948_MASK_FIFO_OVERFLOW_EN		0b00011111

/*
 * INT_ENABLE_3 Bit Masks
 * See ICM-20948 Datasheet, Section 8.10
 */
#define ICM20948_MASK_FIFO_WM_EN		0b00011111

/*
 * I2C_MST_STATUS Bit Masks
 * See ICM-20948 Datasheet, Section 8.11
 */
#define ICM20948_MASK_PASS_THROUGH		BIT(7)
#define ICM20948_MASK_I2C_SLV4_DONE		BIT(6)
#define ICM20948_MASK_I2C_LOST_ARB		BIT(5)
#define ICM20948_MASK_I2C_SLV4_NACK		BIT(4)
#define ICM20948_MASK_I2C_SLV3_NACK		BIT(3)
#define ICM20948_MASK_I2C_SLV2_NACK		BIT(2)
#define ICM20948_MASK_I2C_SLV1_NACK		BIT(1)
#define ICM20948_MASK_I2C_SLV0_NACK		BIT(0)

/*
 * INT_STATUS Bit Masks
 * See ICM-20948 Datasheet, Section 8.12
 */
#define ICM20948_MASK_WOM_INT			BIT(3)
#define ICM20948_MASK_PLL_RDY_INT		BIT(2)
#define ICM20948_MASK_DMP_INT1			BIT(1)
#define ICM20948_MASK_I2C_MST_INT		BIT(0)

/*
 * INT_STATUS_1 Bit Masks
 * See ICM-20948 Datasheet, Section 8.13
 */
#define ICM20948_MASK_RAW_DATA_0_RDY_INT	BIT(0)

/*
 * INT_STATUS_2 Bit Masks
 * See ICM-20948 Datasheet, Section 8.14
 */
#define ICM20948_MASK_FIFO_OVERFLOW_INT		0b00011111

/*
 * INT_STATUS_3 Bit Masks
 * See ICM-20948 Datasheet, Section 8.16
 */
#define ICM20948_MASK_FIFO_WM_INT		0b00011111

/*
 * FIFO_EN_1 Bit Masks
 * See ICM-20948 Datasheet, Section 8.56
 */
#define ICM20948_MASK_SLV_3_FIFO_EN		BIT(3)
#define ICM20948_MASK_SLV_2_FIFO_EN		BIT(2)
#define ICM20948_MASK_SLV_1_FIFO_EN		BIT(1)
#define ICM20948_MASK_SLV_0_FIFO_EN		BIT(0)

/*
 * FIFO_EN_2 Bit Masks
 * See ICM-20948 Datasheet, Section 8.57
 */
#define ICM20948_MASK_ACCEL_FIFO_EN		BIT(4)
#define ICM20948_MASK_GYRO_Z_FIFO_EN		BIT(3)
#define ICM20948_MASK_GYRO_Y_FIFO_EN		BIT(2)
#define ICM20948_MASK_GYRO_X_FIFO_EN		BIT(1)
#define ICM20948_MASK_TEMP_FIFO_EN		BIT(0)

/*
 * FIFO_RST Bit Masks
 * See ICM-20948 Datasheet, Section 8.58
 */
#define ICM20948_MASK_FIFO_RESET		0b00011111

/*
 * FIFO_MODE Bit Masks
 * See ICM-20948 Datasheet, Section 8.59
 */
#define ICM20948_MASK_FIFO_MODE			0b00011111

/*
 * FIFO_COUNTH Bit Masks
 * See ICM-20948 Datasheet, Section 8.60
 */
#define ICM20948_MASK_FIFO_CNT			0b00011111

/*
 * DATA_RDY_STATUS Bit Masks
 * See ICM-20948 Datasheet, Section 8.63
 */
#define ICM20948_MASK_WOF_STATUS		BIT(7)
// #define ICM20948_MASK_FIFO_CNT			0b00001111

/*
 * FIFO_CFG Bit Masks
 * See ICM-20948 Datasheet, Section 8.64
 */
#define ICM20948_MASK_FIFO_CFG			BIT(0)

/*
 * REG_BANK_SEL Bit Masks
 * See ICM-20948 Datasheet, Section 8.65
 */
#define ICM20948_MASK_USER_BANK			0b00110000

/*
 * XA_OFFS_L Bit Masks
 * See ICM-20948 Datasheet, Section 9.8
 */
#define ICM20948_MASK_XA_OFFS			0b11111110

/*
 * YA_OFFS_L Bit Masks
 * See ICM-20948 Datasheet, Section 9.10
 */
#define ICM20948_MASK_YA_OFFS			0b11111110

/*
 * ZA_OFFS_L Bit Masks
 * See ICM-20948 Datasheet, Section 9.12
 */
#define ICM20948_MASK_ZA_OFFS			0b11111110

/*
 * GYRO_CONFIG_1 Bit Masks
 * See ICM-20948 Datasheet, Section 10.2
 */
#define ICM20948_MASK_GYRO_DLPFCFG		0b00111000
#define ICM20948_MASK_GYRO_FS_SEL		0b00000110
#define ICM20948_MASK_GYRO_FCHOICE		BIT(0)

/*
 * GYRO_CONFIG_2 Bit Masks
 * See ICM-20948 Datasheet, Section 10.3
 */
#define ICM20948_MASK_XGYRO_CTEN		BIT(5)
#define ICM20948_MASK_YGYRO_CTEN		BIT(4)
#define ICM20948_MASK_ZGYRO_CTEN		BIT(3)
#define ICM20948_MASK_GYRO_AVGCFG		0b00000111

/*
 * ODR_ALIGN_EN Bit Masks
 * See ICM-20948 Datasheet, Section 10.10
 */
#define ICM20948_MASK_ODR_ALIGN_EN		IT(0)

/*
 * ACCEL_SMPLRT_DIV_1 Bit Masks
 * See ICM-20948 Datasheet, Section 10.11
 */
#define ICM20948_MASK_ACCEL_SMPLRT_DIV		0b00001111

/*
 * ACCEL_INTEL_CTRL Bit Masks
 * See ICM-20948 Datasheet, Section 10.13
 */
#define ICM20948_MASK_ACCEL_INTEL_EN		BIT(1)
#define ICM20948_MASK_ACCEL_INTEL_MODE_INT	BIT(0)

/*
 * ACCEL_CONFIG Bit Masks
 * See ICM-20948 Datasheet, Section 10.15
 */
#define ICM20948_MASK_ACCEL_DLPFCFG		0b00111000
#define ICM20948_MASK_ACCEL_FS_SEL		0b00000110
#define ICM20948_MASK_ACCEL_FCHOICE		BIT(0)

/*
 * ACCEL_CONFIG_2 Bit Masks
 * See ICM-20948 Datasheet, Section 10.16
 */
#define ICM20948_MASK_AX_ST_EN_REG		BIT(4)
#define ICM20948_MASK_AY_ST_EN_REG		BIT(3)
#define ICM20948_MASK_AZ_ST_EN_REG		BIT(2)
#define ICM20948_MASK_DEC3_CFG			0b00000011

/*
 * FSYNC_CONFIG Bit Masks
 * See ICM-20948 Datasheet, Section 10.17
 */
#define ICM20948_MASK_DELAY_TIME_EN		BIT(7)
#define ICM20948_MASK_WOF_DEGLITCH_EN		BIT(5)
#define ICM20948_MASK_WOF_EDGE_INT		BIT(4)
#define ICM20948_MASK_EXT_SYNC_SET		0b00001111

/*
 * TEMP_CONFIG Bit Masks
 * See ICM-20948 Datasheet, Section 10.18
 */
#define ICM20948_MASK_TEMP_DLPFCFG		0b00000111

/*
 * MOD_CTRL_USR Bit Masks
 * See ICM-20948 Datasheet, Section 10.19
 */
#define ICM20948_MASK_REG_LP_DMP_EN		BIT(0)

/*
 * I2C_MST_ODR_CONFIG Bit Masks
 * See ICM-20948 Datasheet, Section 11.1
 */
#define ICM20948_MASK_I2C_MST_ODR_CONFIG	0b00001111

/*
 * I2C_MST_CTRL Bit Masks
 * See ICM-20948 Datasheet, Section 11.2
 */
#define ICM20948_MASK_MULT_MST_EN		BIT(7)
#define ICM20948_MASK_I2C_MST_P_NSR		BIT(4)
#define ICM20948_MASK_I2C_MST_CLK		0b00001111

/*
 * I2C_MST_DELAY_CTRL Bit Masks
 * See ICM-20948 Datasheet, Section 11.3
 */
#define ICM20948_MASK_DELAY_ES_SHADOW		BIT(7)
#define ICM20948_MASK_I2C_SLV4_DELAY_EN		BIT(4)
#define ICM20948_MASK_I2C_SLV3_DELAY_EN		BIT(3)
#define ICM20948_MASK_I2C_SLV2_DELAY_EN		BIT(2)
#define ICM20948_MASK_I2C_SLV1_DELAY_EN		BIT(1)
#define ICM20948_MASK_I2C_SLV0_DELAY_EN		BIT(0)

/*
 * I2C_SLV0_ADDR Bit Masks
 * See ICM-20948 Datasheet, Section 11.4
 */
#define ICM20948_MASK_I2C_SLV0_RNW		BIT(7)
#define ICM20948_MASK_I2C_ID_0			0b01111111

/*
 * I2C_SLV0_CTRL Bit Masks
 * See ICM-20948 Datasheet, Section 11.6
 */
#define ICM20948_MASK_I2C_SLV0_EN		BIT(7)
#define ICM20948_MASK_I2C_SLV0_BYTE_SW		BIT(6)
#define ICM20948_MASK_I2C_SLV0_REG_DIS		BIT(5)
#define ICM20948_MASK_I2C_SLV0_GRP		BIT(4)
#define ICM20948_MASK_I2C_SLV0_LENG		0b00001111

#endif
